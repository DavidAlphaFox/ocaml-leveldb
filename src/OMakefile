
CFLAGS += -g -Wall -O2 -I../leveldb/include -fPIC

%.o: %.c
	$(OCAMLC) -cc g++ $(mapprefix -ccopt, $(CFLAGS)) -c $^

leveldb_stubs.o: leveldb_stubs.cc

section
    leveldb.cma leveldb.a leveldb.cmxa: \
	leveldb_stubs.o levelDB.cmx levelDB.cmo ../leveldb/libleveldb.a
	ocamlmklib \
	    -oc camlleveldb -o leveldb -L../leveldb \
	    -ltcmalloc -lleveldb -lsnappy $^

toplevel: leveldb.cma libcamlleveldb.a
	ocamlmktop -cc g++ -ccopt -Wno-write-strings \
	    -o toplevel -cclib -L. unix.cma threads.cma leveldb.cma -thread

.DEFAULT: leveldb.cma leveldb.cmxa

.PHONY: clean

clean:
	rm -f $(filter-proper-targets $(ls R, .)) *.s *.annot *.so *.a
